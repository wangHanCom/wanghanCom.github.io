<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>工程化 | 汪涵的博客</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link>
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.98136e72.css" as="style"><link rel="preload" href="/assets/js/app.df490d21.js" as="script"><link rel="preload" href="/assets/js/2.9235f093.js" as="script"><link rel="preload" href="/assets/js/34.adb9aee5.js" as="script"><link rel="prefetch" href="/assets/js/10.92f448a7.js"><link rel="prefetch" href="/assets/js/11.d81451ab.js"><link rel="prefetch" href="/assets/js/12.fe657e2d.js"><link rel="prefetch" href="/assets/js/13.673f55af.js"><link rel="prefetch" href="/assets/js/14.33419792.js"><link rel="prefetch" href="/assets/js/15.ab408685.js"><link rel="prefetch" href="/assets/js/16.41231623.js"><link rel="prefetch" href="/assets/js/17.f98cb10c.js"><link rel="prefetch" href="/assets/js/18.dc28497a.js"><link rel="prefetch" href="/assets/js/19.3bd23e42.js"><link rel="prefetch" href="/assets/js/20.48e0bcc4.js"><link rel="prefetch" href="/assets/js/21.4ca137be.js"><link rel="prefetch" href="/assets/js/22.fe35d04c.js"><link rel="prefetch" href="/assets/js/23.e2151993.js"><link rel="prefetch" href="/assets/js/24.42cdd1be.js"><link rel="prefetch" href="/assets/js/25.2ef590fe.js"><link rel="prefetch" href="/assets/js/26.88fd7535.js"><link rel="prefetch" href="/assets/js/27.aefa961a.js"><link rel="prefetch" href="/assets/js/28.5b4073a9.js"><link rel="prefetch" href="/assets/js/29.4c27b4b2.js"><link rel="prefetch" href="/assets/js/3.74014b60.js"><link rel="prefetch" href="/assets/js/30.f97becd7.js"><link rel="prefetch" href="/assets/js/31.92fc7f70.js"><link rel="prefetch" href="/assets/js/32.d7c4f275.js"><link rel="prefetch" href="/assets/js/33.8d2027ca.js"><link rel="prefetch" href="/assets/js/35.34cb4c23.js"><link rel="prefetch" href="/assets/js/4.ddf5fb83.js"><link rel="prefetch" href="/assets/js/5.2f6ceb2d.js"><link rel="prefetch" href="/assets/js/6.acebe267.js"><link rel="prefetch" href="/assets/js/7.4f5a488b.js"><link rel="prefetch" href="/assets/js/8.d3b85309.js"><link rel="prefetch" href="/assets/js/9.395837cf.js">
    <link rel="stylesheet" href="/assets/css/0.styles.98136e72.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">汪涵的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机网络</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>webpack</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/webpack/devServer.html" class="sidebar-link">devServer</a></li><li><a href="/webpack/import.html" class="sidebar-link">webpack全局引入的问题</a></li><li><a href="/webpack/loader.html" class="sidebar-link">Loader</a></li><li><a href="/webpack/package.html" class="sidebar-link">webpack 基础</a></li><li><a href="/webpack/splitCode.html" class="sidebar-link">代码分割</a></li><li><a href="/webpack/project.html" aria-current="page" class="active sidebar-link">工程化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/webpack/project.html#_2-1-玩转npm-srcipt" class="sidebar-link">2-1 玩转npm srcipt</a></li><li class="sidebar-sub-header"><a href="/webpack/project.html#_2-2-bash简介和快速入门" class="sidebar-link">2-2 Bash简介和快速入门</a></li><li class="sidebar-sub-header"><a href="/webpack/project.html#_2-3-浅谈nodecli" class="sidebar-link">2-3 浅谈nodecli</a></li><li class="sidebar-sub-header"><a href="/webpack/project.html#_3-规范先行（规范类暂不整理）" class="sidebar-link">3 规范先行（规范类暂不整理）</a></li><li class="sidebar-sub-header"><a href="/webpack/project.html#_4、测试相关" class="sidebar-link">4、测试相关</a></li><li class="sidebar-sub-header"><a href="/webpack/project.html#_4-3-单元测试" class="sidebar-link">4-3 单元测试</a></li><li class="sidebar-sub-header"><a href="/webpack/project.html#_4-4-端到端测试" class="sidebar-link">4-4  端到端测试</a></li><li class="sidebar-sub-header"><a href="/webpack/project.html#_5-工程设计" class="sidebar-link">5-工程设计</a></li><li class="sidebar-sub-header"><a href="/webpack/project.html#_6-1-构建简史" class="sidebar-link">6-1 构建简史</a></li><li class="sidebar-sub-header"><a href="/webpack/project.html#_6-2-不得不提的babel" class="sidebar-link">6-2 不得不提的babel</a></li><li class="sidebar-sub-header"><a href="/webpack/project.html#_6-3-babel基本概念" class="sidebar-link">6-3 babel基本概念</a></li><li class="sidebar-sub-header"><a href="/webpack/project.html#_6-4-babel" class="sidebar-link">6-4 babel</a></li><li class="sidebar-sub-header"><a href="/webpack/project.html#_6-5-babel插件开发" class="sidebar-link">6-5 babel插件开发</a></li><li class="sidebar-sub-header"><a href="/webpack/project.html#_6-6-webpack设计思想" class="sidebar-link">6-6 webpack设计思想</a></li><li class="sidebar-sub-header"><a href="/webpack/project.html#_6-6-webpack主要概念" class="sidebar-link">6-6 webpack主要概念</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="工程化"><a href="#工程化" class="header-anchor">#</a> 工程化</h1> <h2 id="_2-1-玩转npm-srcipt"><a href="#_2-1-玩转npm-srcipt" class="header-anchor">#</a> 2-1 玩转npm srcipt</h2> <h3 id="npm的常用命令"><a href="#npm的常用命令" class="header-anchor">#</a> npm的常用命令</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> init     		//初始化工程
<span class="token function">npm</span> run      		//run script  执行package.json中的script脚本
<span class="token function">npm</span> <span class="token function">install</span>  		//安装依赖
<span class="token function">npm</span> update  		//升级依赖
<span class="token function">npm</span> bin					//查看bin文件目录
<span class="token function">npm</span> <span class="token function">link</span>				//将工程软链接到全局
<span class="token function">npm</span> publish			//发布包
<span class="token function">npm</span> deprecake 	//废弃包
</code></pre></div><h4 id="npm-init-初始化一个项目"><a href="#npm-init-初始化一个项目" class="header-anchor">#</a> npm init 初始化一个项目</h4> <p>在node开发中使用npm init会生成一个pakeage.json文件</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 在需要初始化的项目目录下执行</span>
$ <span class="token builtin class-name">cd</span> project
$ <span class="token function">npm</span> init project
</code></pre></div><h4 id="npm-run-执行脚本"><a href="#npm-run-执行脚本" class="header-anchor">#</a> npm run 执行脚本</h4> <p><strong>原理：</strong>
npm 脚本的原理非常简单。每当执行npm run，就会自动新建一个 Shell，在这个 Shell 里面执行指定的脚本命令。
npm 允许在package.json文件里面，使用scripts字段定义脚本命令。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node index.js&quot;</span>   <span class="token comment">//执行根路径下的index.js文件</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">npm</span> run <span class="token builtin class-name">test</span>
<span class="token comment"># 等同于执行</span>
$ node index.js  
</code></pre></div><p>注意点</p> <ol><li>当前目录的node_modules/.bin子目录里面的所有脚本，都可以直接用脚本名调用，而不必加上路径。比如，当前项目的依赖里面有 Mocha，只要直接写mocha test就可以了。</li> <li>如果是普通文件需要加上路径。比如 <code>&quot;test&quot;: &quot;node src/index.js&quot;</code></li> <li>npm 脚本的唯一要求就是可以在 Shell 执行，因此它不一定是 Node 脚本，任何可执行文件都可以写在里面。</li></ol> <h4 id="npm-scripts内部变量"><a href="#npm-scripts内部变量" class="header-anchor">#</a> npm scripts内部变量</h4> <div class="language- extra-class"><pre class="language-text"><code>$npm_package_name							#name in package.json
$npm_package_version					#version in package.json
$npm_package_config_var1			#config in package.json
</code></pre></div><p>示例：
输出 the  package is XXX</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">//package.json</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;testwebpack&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;工程化学习&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node src/index.js&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//index.js</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;the package is &quot;</span><span class="token operator">+</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>npm_package_name<span class="token punctuation">)</span>
</code></pre></div><p>执行  npm  test后输出
<img src="https://cdn.nlark.com/yuque/0/2020/png/2362456/1607862958896-5ea38a39-fb87-421e-b336-54abf09823f1.png#align=left&amp;display=inline&amp;height=20&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=40&amp;originWidth=362&amp;size=3243&amp;status=done&amp;style=none&amp;width=181" alt="image.png"></p> <h4 id="npm-script-传参"><a href="#npm-script-传参" class="header-anchor">#</a> npm script 传参</h4> <p>问题如何向封装过的命令传参</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token property">&quot;server&quot;</span><span class="token operator">:</span><span class="token string">&quot;server ./build&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;server:prod&quot;</span><span class="token operator">:</span><span class="token string">&quot;npm run server -- -l 80&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>实际的使用场景？？</p> <h4 id="npm-script-钩子函数"><a href="#npm-script-钩子函数" class="header-anchor">#</a> npm script 钩子函数</h4> <p>npm 脚本有pre和post两个钩子。举例来说，build脚本命令的钩子就是prebuild和postbuild。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">//package.json</span>
<span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;pretest&quot;</span><span class="token operator">:</span><span class="token string">&quot;echo before test&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node src/index.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;posttest&quot;</span><span class="token operator">:</span><span class="token string">&quot;echo after test&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>执行npm run build的时候，会<strong>自动</strong>按照下面的顺序执行。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> run pretest <span class="token operator">&amp;&amp;</span> <span class="token function">npm</span> run <span class="token builtin class-name">test</span> <span class="token operator">&amp;&amp;</span> <span class="token function">npm</span> run posttest
</code></pre></div><p><img src="https://cdn.nlark.com/yuque/0/2020/png/2362456/1607864384884-d68f7297-9d59-40ef-b1cc-62f2ed21afba.png#align=left&amp;display=inline&amp;height=220&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=440&amp;originWidth=828&amp;size=54274&amp;status=done&amp;style=none&amp;width=414" alt="image.png">
应用场景
发版前对版本号进行自增</p> <h4 id="npm-script-执行顺序"><a href="#npm-script-执行顺序" class="header-anchor">#</a> npm script 执行顺序</h4> <p>并行执行（即同时的平行执行）</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">npm</span> run script1.js <span class="token operator">&amp;</span> <span class="token function">npm</span> run script2.js
</code></pre></div><p>顺序执行（即只有前一个任务成功，才执行下一个任务）</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">npm</span> run script1.js <span class="token operator">&amp;&amp;</span> <span class="token function">npm</span> run script2.js
</code></pre></div><p>其他补充：</p> <ol><li><code>#！</code>这个符号通常在Unix系统的第一行开头中出现，用于指明这个脚本文件的解释程序。增加这一行是为了指定用node执行脚本文件。</li> <li>输入命令后，会有在一个新建的shell中执行指定的脚本，在执行这个脚本的时候，我们需要来指定这个脚本的解释程序是node。</li> <li><code>/usr/bin/env</code>就是告诉系统可以在PATH目录中查找node路径。</li></ol> <p>配置<code>#!/usr/bin/env node</code>是解决了不同的用户node路径不同的问题，可以让系统动态的去查找node来执行你的脚本文件。</p> <p>参考资料
<a href="https://www.ruanyifeng.com/blog/2016/10/npm_scripts.html" target="_blank" rel="noopener noreferrer">npm scripts 使用指南<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="_2-2-bash简介和快速入门"><a href="#_2-2-bash简介和快速入门" class="header-anchor">#</a> 2-2 Bash简介和快速入门</h2> <h3 id="概念"><a href="#概念" class="header-anchor">#</a> 概念</h3> <p>Shell 是一个用 C 语言编写的程序，它是用户使用 Linux 的桥梁。Shell 既是一种命令语言，又是一种程序设计语言。
bash是shell的语法解释器，Bash 也是大多数Linux 系统默认的 Shell。
shell解释器</p> <ol><li>bash</li> <li>sh（linux默认的语法解释器）</li> <li>zsh（mac下的解释器，交互比较友好）</li> <li>cmd （windows下的解释器）</li></ol> <h3 id="常用的bash命令"><a href="#常用的bash命令" class="header-anchor">#</a> 常用的bash命令</h3> <p>帮助命令
--help    man</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 帮助命令</span>
$ <span class="token function">man</span> <span class="token function">ps</span>   <span class="token comment"># 可以查看ps所有的用法</span>
<span class="token comment"># 文件管理</span>
$ <span class="token function">touch</span> index.js <span class="token comment"># 新建一个文件</span>
$ <span class="token function">mkdir</span> ./project  <span class="token comment"># 创建一个文件夹 </span>
$ <span class="token function">mkdir</span> ./project2  <span class="token comment"># 创建一个文件夹(同上)</span>
$ <span class="token function">rmdir</span> ./project2   <span class="token comment"># 删除一个文件夹</span>
$ <span class="token function">rm</span>  shellTest.js   <span class="token comment"># 删除一个文件</span>
$ <span class="token function">mv</span> indes.js ./main  <span class="token comment"># 将文件移动到 ./main这个路径</span>
$ <span class="token function">cp</span> indes.js  ./main2  <span class="token comment">#将文件复制到./mian2这个路径</span>
$ <span class="token function">cat</span>  ./package.json   <span class="token comment">#查看文件</span>
$ <span class="token function">head</span> -n <span class="token number">10</span> ./package.json  <span class="token comment">#查看文件的前十行</span>
$ <span class="token function">tail</span> -n <span class="token number">10</span> ./package.json  <span class="token comment">#查看文件的后十行</span>
<span class="token comment"># 文件编辑  nano  vim</span>
<span class="token comment"># 进程相关</span>
$ <span class="token function">ps</span>  <span class="token comment"># 查看当前用户进程状态</span>
$ <span class="token function">ps</span> -ax  <span class="token comment"># 查看所有进程</span>
$ <span class="token function">lsof</span> -i <span class="token comment"># 查看打开的网络相关文件</span>
$ <span class="token function">top</span> <span class="token comment"># 查看当前状态，比如系统负载，内存使用，使用进程相关</span>
$ <span class="token function">kill</span> <span class="token number">45934</span> <span class="token comment"># 发送SIGTERM信号，在这里代表杀死pid为45934的进程</span>
$ <span class="token function">kill</span> -9 <span class="token number">45934</span> <span class="token comment"># SIGKILL,强杀进程</span>

</code></pre></div><p><img src="https://cdn.nlark.com/yuque/0/2020/png/2362456/1607905743218-8dac9e99-8a2d-4a11-80c2-aa0c70f1741d.png#align=left&amp;display=inline&amp;height=79&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=158&amp;originWidth=1566&amp;size=157261&amp;status=done&amp;style=none&amp;width=783" alt="image.png"></p> <p>学习资料
<a href="http://cn.linux.vbird.org/" target="_blank" rel="noopener noreferrer">《鸟哥的Linux私房菜（基础学习篇）》<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="http://linuxcommand.org/tlcl.php" target="_blank" rel="noopener noreferrer">《The Linux Command Line》<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="_2-3-浅谈nodecli"><a href="#_2-3-浅谈nodecli" class="header-anchor">#</a> 2-3 浅谈nodecli</h2> <h3 id="process-argv"><a href="#process-argv" class="header-anchor">#</a> process.argv</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//process-args.js</span>
process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">val<span class="token punctuation">,</span>index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>index<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>val<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在js文件中打印以上内容
在控制台中执行</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token variable">$node</span> process-args.js
</code></pre></div><p><img src="https://cdn.nlark.com/yuque/0/2020/png/2362456/1608123218895-fb5d4d65-13cd-4a5c-9ba3-2cdee6640ca5.png#align=left&amp;display=inline&amp;height=65&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=130&amp;originWidth=730&amp;size=22557&amp;status=done&amp;style=none&amp;width=365" alt="image.png">
第一个输出node路径(process.execPath)
第二个输出正在执行文件的路径
第三、四个输出的是传入的参数</p> <h3 id="commander"><a href="#commander" class="header-anchor">#</a> commander</h3> <p>更方便的cli参数处理</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>program<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'commander'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

program
<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">'better-clone'</span><span class="token punctuation">)</span>  <span class="token comment">//通过name定义名称</span>
<span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token string">'0.0.1'</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-v,--verbose'</span><span class="token punctuation">,</span><span class="token string">'verbosity that can be increased'</span><span class="token punctuation">)</span>   <span class="token comment">//通过options定义一些配置</span>

program
<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">'clone &lt;source&gt; [destination]'</span><span class="token punctuation">)</span> <span class="token comment">//定义一个子命令</span>
<span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-d,--depths&lt;level&gt;'</span><span class="token punctuation">,</span><span class="token string">'git clone depths'</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">'clone a repository into a newly created directory'</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">source<span class="token punctuation">,</span>destination<span class="token punctuation">,</span>cmdObj</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span> <span class="token comment">//构造一个子命令的真实逻辑</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>

program<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">)</span>
</code></pre></div><h3 id="inquirer-js-可视化交互"><a href="#inquirer-js-可视化交互" class="header-anchor">#</a> inquirer.js 可视化交互</h3> <p>提供更灵活的cli交互方式
磨平平台间的差异</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> inquirer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'inquirer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
inquirer
<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token comment">//输入框和选择框</span>
    <span class="token punctuation">{</span>type<span class="token operator">:</span><span class="token string">'input'</span><span class="token punctuation">,</span>name<span class="token operator">:</span><span class="token string">'username'</span><span class="token punctuation">,</span>message<span class="token operator">:</span><span class="token string">&quot;what`s ur name&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>type<span class="token operator">:</span><span class="token string">'checkbox'</span><span class="token punctuation">,</span>name<span class="token operator">:</span><span class="token string">'gender'</span><span class="token punctuation">,</span>message<span class="token operator">:</span><span class="token string">&quot;whta ur gender?&quot;</span><span class="token punctuation">,</span>choices<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'male'</span><span class="token punctuation">,</span><span class="token string">'female'</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">answers</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">name  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>answers<span class="token punctuation">.</span>username<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>`gender  $<span class="token punctuation">{</span>answers<span class="token punctuation">.</span>gender<span class="token punctuation">}</span>`<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token comment">//...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>输出
<img src="https://cdn.nlark.com/yuque/0/2020/png/2362456/1608126219181-418b5587-cc4e-4ef9-91e6-a6015e0c14f3.png#align=left&amp;display=inline&amp;height=62&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=124&amp;originWidth=476&amp;size=14651&amp;status=done&amp;style=none&amp;width=238" alt="image.png"></p> <h3 id="拆解cli设计-以脚手架为例"><a href="#拆解cli设计-以脚手架为例" class="header-anchor">#</a> 拆解cli设计-以脚手架为例</h3> <ol><li>参数的输入，结果的输出</li></ol> <p>commanderjs（更方便的参数处理），inquirer（更好的交互），chalk（颜色高亮）</p> <ol start="2"><li>模版在哪里维护</li></ol> <p>git仓库</p> <ol start="3"><li>如何获取模版</li></ol> <p>git clone，使用execa或者shell.js调用
4.如何生成工程
模版引擎，handerbars</p> <h3 id="新一代脚手架"><a href="#新一代脚手架" class="header-anchor">#</a> 新一代脚手架</h3> <p>schemtics</p> <ul><li>可以做到语法级别的样板代码生成</li> <li>引入了虚拟文件系统，可以保证写入原子性</li> <li>支持多个schemtics之间的组合管道</li></ul> <h2 id="_3-规范先行（规范类暂不整理）"><a href="#_3-规范先行（规范类暂不整理）" class="header-anchor">#</a> 3 规范先行（规范类暂不整理）</h2> <p><img src="https://cdn.nlark.com/yuque/0/2020/png/2362456/1608126956289-199e4788-c98a-4520-ae50-7686eb60a4ff.png#align=left&amp;display=inline&amp;height=473&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=946&amp;originWidth=1392&amp;size=199385&amp;status=done&amp;style=none&amp;width=696" alt="image.png"></p> <ul><li>major：主版本，一般代表着breaking change，例如vue1.x和vue2.x</li> <li>minor：次版本，一般代表着新feature的出现</li> <li>patch：一般不包含新功能，知识bugfix或和功能关系不大的修改</li> <li>pre-release: 预发行版本，一般用于正式版本发行前的验证、联调和测试</li></ul> <h2 id="_4、测试相关"><a href="#_4、测试相关" class="header-anchor">#</a> 4、测试相关</h2> <h3 id="_4-1-code-review"><a href="#_4-1-code-review" class="header-anchor">#</a> 4-1 code review</h3> <h3 id="_4-2-测试基础"><a href="#_4-2-测试基础" class="header-anchor">#</a> 4-2 测试基础</h3> <p>参考资料
<a href="https://jestjs.io/docs/en/getting-started" target="_blank" rel="noopener noreferrer">Jest<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="https://jestjs.io/docs/en/expect" target="_blank" rel="noopener noreferrer">更多Matchers<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="https://jestjs.io/docs/en/mock-function-api" target="_blank" rel="noopener noreferrer">更多Mock用法<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="http://www.alloyteam.com/2019/07/13481/" target="_blank" rel="noopener noreferrer">伊斯坦布尔测试覆盖率的实现原理<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="_4-3-单元测试"><a href="#_4-3-单元测试" class="header-anchor">#</a> 4-3 单元测试</h2> <h2 id="_4-4-端到端测试"><a href="#_4-4-端到端测试" class="header-anchor">#</a> 4-4  端到端测试</h2> <p>常见框架
<img src="https://cdn.nlark.com/yuque/0/2020/png/2362456/1608250544424-7ab01c79-1f81-497f-8f54-7b2ec260cd07.png#align=left&amp;display=inline&amp;height=414&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=828&amp;originWidth=1414&amp;size=439117&amp;status=done&amp;style=none&amp;width=707" alt="image.png"> <img src="https://cdn.nlark.com/yuque/0/2020/png/2362456/1608250587462-5fb11f10-f016-4573-b031-ff3695329e87.png#align=left&amp;display=inline&amp;height=320&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=640&amp;originWidth=1176&amp;size=287058&amp;status=done&amp;style=none&amp;width=588" alt="image.png"></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//index.spec.js</span>
<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Main Process'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    cy<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span><span class="token string">'http://localhost:8080/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//访问应用的地址  </span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Make a Todo'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">'some things'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取第一个输入框，输入内容</span>
    cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'.v-input__append-outer .v-icon--link'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//模拟点击添加</span>
    cy<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'.v-list&gt;div .v-list__title__content'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">should</span><span class="token punctuation">(</span><span class="token string">'have.text'</span><span class="token punctuation">,</span><span class="token string">'some things'</span><span class="token punctuation">)</span><span class="token comment">//通过断言判断是否添加成功</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>可视化界面
<img src="https://cdn.nlark.com/yuque/0/2020/png/2362456/1608362083140-5ddd0813-109a-47ca-ace7-9290653d24cb.png#align=left&amp;display=inline&amp;height=506&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1012&amp;originWidth=1998&amp;size=711596&amp;status=done&amp;style=none&amp;width=999" alt="image.png"></p> <h2 id="_5-工程设计"><a href="#_5-工程设计" class="header-anchor">#</a> 5-工程设计</h2> <p>本章节主要讲设计规范不详细记录
<strong>参考链接</strong> <a href="https://blog.devtang.com/2013/05/08/git-submodule-issues/" target="_blank" rel="noopener noreferrer">Git submodule的坑<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="https://github.com/apenwarr/git-subtree/" target="_blank" rel="noopener noreferrer">git subtree<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="https://blog.npmjs.org/post/617484925547986944/npm-v7-series-introduction" target="_blank" rel="noopener noreferrer">npm v7 Series - Introduction<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="https://blog.npmjs.org/post/617484925547986944/npm-v7-series-introduction" target="_blank" rel="noopener noreferrer">https://blog.npmjs.org/post/617484925547986944/npm-v7-series-introduction  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="https://nx.dev/" target="_blank" rel="noopener noreferrer">NX<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="_6-1-构建简史"><a href="#_6-1-构建简史" class="header-anchor">#</a> 6-1 构建简史</h2> <h2 id="_6-2-不得不提的babel"><a href="#_6-2-不得不提的babel" class="header-anchor">#</a> 6-2 不得不提的babel</h2> <h3 id="回顾ast"><a href="#回顾ast" class="header-anchor">#</a> 回顾AST</h3> <p>AST是一种可遍历、描述代码的树状结构。利用AST可以方便的分析代码的结构和内容。
代码和AST的转换如下：
<img src="https://cdn.nlark.com/yuque/0/2020/png/2362456/1609159016540-5dc277e1-2afe-4fee-b9f0-74a5ec060590.png#align=left&amp;display=inline&amp;height=562&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1124&amp;originWidth=1976&amp;size=1138391&amp;status=done&amp;style=none&amp;width=988" alt="image.png">
AST的生成过程需要复习</p> <h3 id="基础编译理论"><a href="#基础编译理论" class="header-anchor">#</a> 基础编译理论</h3> <p><img src="https://cdn.nlark.com/yuque/0/2020/png/2362456/1609159452728-a447964d-b4ee-49c2-ad6b-590ee27cb804.png#align=left&amp;display=inline&amp;height=442&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=884&amp;originWidth=1882&amp;size=657981&amp;status=done&amp;style=none&amp;width=941" alt="image.png"> <strong>词法分析</strong>：按照某一语言的规则解析字符串。将人为书写的代码转换成定义这门语言的基本单位。这个基本单位为token。
<strong>语法分析</strong>：通过token生成初始的AST结构。
<strong>语义分析</strong>：遍历这个AST对节点的属性进行补全。对分析的结果进行增强。
<strong>中间代码生成</strong>：将AST生成和平台无关的代码。
<strong>目标代码生成</strong>：将中间代码转换成目标平台的代码。如果没有多个目标平台，可忽略“中间代码生成”这一步骤。**</p> <h3 id="babel中的编译"><a href="#babel中的编译" class="header-anchor">#</a> Babel中的编译</h3> <p>babel也是编译器，输入高版本代码，输出低版本代码。</p> <h4 id="babel的工作步骤"><a href="#babel的工作步骤" class="header-anchor">#</a> babel的工作步骤</h4> <ol><li>解析：解析代码，生成AST</li> <li>变换：操作AST，修改其内容</li> <li>生成：根据AST生成新的代码</li></ol> <p>代码演练
1、将代码转换成token</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> input  <span class="token operator">=</span> <span class="token string">'(add 2 (subtract 4 2))'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">tokenizer</span><span class="token punctuation">(</span><span class="token parameter">input</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">let</span> current <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> tokens <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">//通过循环，排除空格等无用的信息。输入的是字符串</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>current <span class="token operator">&lt;</span> input<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//每次取一个字符串进行操作，然后累加计数器</span>
    <span class="token keyword">let</span> char <span class="token operator">=</span> input<span class="token punctuation">[</span>current<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>char <span class="token operator">===</span> <span class="token string">'('</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      tokens<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token string">'paren'</span><span class="token punctuation">,</span>
        value<span class="token operator">:</span> <span class="token string">'('</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 累加然后继续循环</span>
      current<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token keyword">continue</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">//...处理右括号</span>

    <span class="token comment">//如果是空格忽略，累加继续循环</span>
    <span class="token keyword">let</span> <span class="token constant">WHITESPACE</span> <span class="token operator">=</span> <span class="token regex">/\s/</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">WHITESPACE</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      current<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token keyword">continue</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> <span class="token constant">NUMBERS</span> <span class="token operator">=</span> <span class="token regex">/[0-9]/</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NUMBERS</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token constant">NUMBERS</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//将连续的数字存为一个字段</span>
        value <span class="token operator">+=</span> char<span class="token punctuation">;</span>
        char <span class="token operator">=</span> input<span class="token punctuation">[</span><span class="token operator">++</span>current<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      tokens<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'number'</span><span class="token punctuation">,</span> value <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//将数字的最终结果存起来</span>
      <span class="token keyword">continue</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//...处理字符串</span>

    <span class="token keyword">let</span> <span class="token constant">LETTERS</span> <span class="token operator">=</span> <span class="token regex">/[a-z]/i</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">LETTERS</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//将连续的字母存为一个字段</span>
      <span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token constant">LETTERS</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        value <span class="token operator">+=</span> char<span class="token punctuation">;</span>
        char <span class="token operator">=</span> input<span class="token punctuation">[</span><span class="token operator">++</span>current<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      tokens<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'name'</span><span class="token punctuation">,</span> value <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//只存一次</span>

      <span class="token keyword">continue</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

  <span class="token punctuation">}</span>

 <span class="token comment">//返回最终数组形式的token</span>
  <span class="token keyword">return</span> tokens<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>处理结果：
<img src="https://cdn.nlark.com/yuque/0/2020/png/2362456/1609161838860-8ac37cba-91d4-4a8a-b02c-98bab092d052.png#align=left&amp;display=inline&amp;height=180&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=360&amp;originWidth=602&amp;size=55147&amp;status=done&amp;style=none&amp;width=301" alt="image.png"></p> <p>2、token转换成AST语法树</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">parser</span><span class="token punctuation">(</span><span class="token parameter">tokens</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//全局的技术变量，保证不重复</span>
    <span class="token keyword">let</span> current <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">walk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> token <span class="token operator">=</span> tokens<span class="token punctuation">[</span>current<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">//数字或者字母直接返回</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'number'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            current<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                type<span class="token operator">:</span> <span class="token string">'NumberLiteral'</span><span class="token punctuation">,</span>
                value<span class="token operator">:</span> token<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            current<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                type<span class="token operator">:</span> <span class="token string">'StringLiteral'</span><span class="token punctuation">,</span>
                value<span class="token operator">:</span> token<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//如果是左括号开头</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>
            token<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'paren'</span> <span class="token operator">&amp;&amp;</span>
            token<span class="token punctuation">.</span>value <span class="token operator">===</span> <span class="token string">'('</span>
        <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            token <span class="token operator">=</span> tokens<span class="token punctuation">[</span><span class="token operator">++</span>current<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token comment">//取左括号临近的一个值作为函数名</span>
            <span class="token keyword">let</span> node <span class="token operator">=</span> <span class="token punctuation">{</span>
                type<span class="token operator">:</span> <span class="token string">'CallExpression'</span><span class="token punctuation">,</span>
                name<span class="token operator">:</span> token<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
                params<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token comment">//取下一个变量</span>
            token <span class="token operator">=</span> tokens<span class="token punctuation">[</span><span class="token operator">++</span>current<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>
                <span class="token punctuation">(</span>token<span class="token punctuation">.</span>type <span class="token operator">!==</span> <span class="token string">'paren'</span><span class="token punctuation">)</span> <span class="token operator">||</span>
                <span class="token punctuation">(</span>token<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'paren'</span> <span class="token operator">&amp;&amp;</span> token<span class="token punctuation">.</span>value <span class="token operator">!==</span> <span class="token string">')'</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//在遇到下一个右括号之前所有的元素都放在函数名下当做参数</span>
                node<span class="token punctuation">.</span>params<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">walk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                token <span class="token operator">=</span> tokens<span class="token punctuation">[</span>current<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            current<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> node<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span>token<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> ast <span class="token operator">=</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token string">'Program'</span><span class="token punctuation">,</span>
        body<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">//循环遍历数组，遍历成树形结构</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>current <span class="token operator">&lt;</span> tokens<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ast<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">walk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> ast<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>处理结果
<img src="https://cdn.nlark.com/yuque/0/2020/png/2362456/1609232234352-7991c1f4-b068-4ddd-b738-61c68fc33c60.png#align=left&amp;display=inline&amp;height=185&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=185&amp;originWidth=263&amp;size=39483&amp;status=done&amp;style=none&amp;width=263" alt="image.png"></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">'Program'</span><span class="token punctuation">,</span>
  body<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">'CallExpression'</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'add'</span><span class="token punctuation">,</span>
    params<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token comment">//2个参数</span>
      type<span class="token operator">:</span> <span class="token string">'NumberLiteral'</span><span class="token punctuation">,</span>
      value<span class="token operator">:</span> <span class="token string">'2'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">'CallExpression'</span><span class="token punctuation">,</span>
      name<span class="token operator">:</span> <span class="token string">'subtract'</span><span class="token punctuation">,</span>
      params<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token comment">//2个参数</span>
        type<span class="token operator">:</span> <span class="token string">'NumberLiteral'</span><span class="token punctuation">,</span>
        value<span class="token operator">:</span> <span class="token string">'4'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token string">'NumberLiteral'</span><span class="token punctuation">,</span>
        value<span class="token operator">:</span> <span class="token string">'2'</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>3、transformation转换
Traverser函数：深度优先遍历AST树
Transformer函数：在遍历到每一个节点时调用，将旧AST转换成一颗新树</p> <p>4、code generator
深度优先地遍历新的AST树，将每个节点依次组合成新的代码
总结：</p> <ol><li>input     =》tokenizer    =》toknes</li> <li>tokens   =》parser        =》ast</li> <li>ast        =》transformer =》newAst</li> <li>newAst  =》generator    =》output</li></ol> <p><strong>扩展资料</strong> <a href="https://astexplorer.net/" target="_blank" rel="noopener noreferrer">AST   explorer（ast转换）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="https://github.com/jamiebuilds/the-super-tiny-compiler" target="_blank" rel="noopener noreferrer">the-super-tiny-compiler项目（一个小型的babel）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="http://www.icourse163.org/course/HIT-1002123007" target="_blank" rel="noopener noreferrer">中国大学慕课：编译原理 哈尔滨工业大学：<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="_6-3-babel基本概念"><a href="#_6-3-babel基本概念" class="header-anchor">#</a> 6-3 babel基本概念</h2> <h3 id="babel的作用"><a href="#babel的作用" class="header-anchor">#</a> babel的作用</h3> <p>语法转换：高版本转成低版本
polyfill：让老环境支持新的API
源码修改 ：去除flow/typeScript代码中的类型标识</p> <h3 id="syntax和feature的区别"><a href="#syntax和feature的区别" class="header-anchor">#</a> Syntax和feature的区别</h3> <p>Syntax
语言级的某一种概念的写法，不可被语言中其他概念实现。例如：箭头函数，class类，es模块。
Feature
实例方法，静态方法，全局对象，可以被我们自己实现。例如：promise，object.keys，[].includes.</p> <h3 id="plugin-preset-env的区别"><a href="#plugin-preset-env的区别" class="header-anchor">#</a> plugin/preset/env的区别</h3> <h4 id="plugin"><a href="#plugin" class="header-anchor">#</a> plugin</h4> <p>插件，babel本身不会对代码做任何修改，所有的功能都靠插件实现。</p> <h4 id="preset"><a href="#preset" class="header-anchor">#</a> preset</h4> <p>一组插件的集合。官方的preset：@babel/preset-env、@babel/preset-flow、@babel/preset-react
stage-x
ECMAScript语言新特性会经历5个阶段后才会被正式宣布
stage-0 提案刚提出的时候，仅是个想法
stage-1 大家发现这个歌是个值得取实现的提案
stage-2 草稿阶段：形成最初的规范文档
stage-3 候选人阶段
stage-4  结束阶段，明年会正式发布
以上在babel7中已经被废弃</p> <h4 id="env"><a href="#env" class="header-anchor">#</a> env</h4> <p>@babel/preset-env 是一种更加只能的preset，可以根据目标环境，快速配置babel</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;targets&quot;</span><span class="token operator">:</span><span class="token string">&quot;&gt; 0.25%, not dead&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_6-4-babel"><a href="#_6-4-babel" class="header-anchor">#</a> 6-4 babel</h2> <h3 id="babel-cli"><a href="#babel-cli" class="header-anchor">#</a> babel cli</h3> <p>在加载js文件前按照配置进行转换</p> <div class="language-shell extra-class"><pre class="language-shell"><code>babel src --out-dir lib --ignore <span class="token string">&quot;src/**/*.spec.js&quot;</span>
babel-node --inspect --presets @babel/preset-env -- script.js --inspect
</code></pre></div><h3 id="babel的配置"><a href="#babel的配置" class="header-anchor">#</a> babel的配置</h3> <p>项目根目录的 .babelrc.json:对整个项目生效
工程根目录的 babel.config.json:对整个工程生效（可以跨项目）
package.json的 babel字段  相当于.babelrc.json</p> <p>plugin的执行顺序
plugin在preset之前执行，plugin放一些比较新的特性，preset一般是比较稳定的特性，保证新特性先被转换。
plugin之间的顺序是从前往后执行。</p> <p>preset的执行顺序
preset在plugin之后执行。
preset之间的顺序是从后往前执行。</p> <p>preset-env的配置
主要是usebuiltins和target两个配置
usebuiltins用来配置polyfill
target来告诉preset-env要选择那些插件</p> <p>usebuiltins的配置
有3个值  “usage”、“entry”，false（默认）
用于自动注入polyfill代码
1、false：什么也不做，不自动注入polyfill
2、entry：根据环境配置自动注入polyfill
3、usage：根据实际使用自动注入polyfill</p> <p>polyfill
<img src="https://cdn.nlark.com/yuque/0/2020/png/2362456/1609253807203-79b92192-9098-4c11-aadd-1ab333cafa54.png#align=left&amp;display=inline&amp;height=289&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=578&amp;originWidth=1642&amp;size=298121&amp;status=done&amp;style=none&amp;width=821" alt="image.png">
core-js的使用
<img src="https://cdn.nlark.com/yuque/0/2020/png/2362456/1609254226643-d5757b5e-7e52-4d70-9669-b72c15a2637e.png#align=left&amp;display=inline&amp;height=471&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=942&amp;originWidth=1694&amp;size=527411&amp;status=done&amp;style=none&amp;width=847" alt="image.png"> <img src="https://cdn.nlark.com/yuque/0/2020/png/2362456/1609254323390-bc5255fa-6753-4d35-beca-112c5f922d92.png#align=left&amp;display=inline&amp;height=413&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=826&amp;originWidth=2010&amp;size=729314&amp;status=done&amp;style=none&amp;width=1005" alt="image.png"></p> <p><img src="https://cdn.nlark.com/yuque/0/2020/png/2362456/1609253946402-e0846b04-81d5-4404-8390-bde592a071c1.png#align=left&amp;display=inline&amp;height=498&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=996&amp;originWidth=1906&amp;size=915899&amp;status=done&amp;style=none&amp;width=953" alt="image.png"></p> <p><img src="https://cdn.nlark.com/yuque/0/2020/png/2362456/1609254081109-6b5f3cd2-73f0-4bc5-ab7f-7d43a14c677e.png#align=left&amp;display=inline&amp;height=437&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=874&amp;originWidth=1158&amp;size=374202&amp;status=done&amp;style=none&amp;width=579" alt="image.png"></p> <p><a href="https://github.com/browserslist/browserslist" target="_blank" rel="noopener noreferrer">browserlist项目地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="https://github.com/kangax/compat-table" target="_blank" rel="noopener noreferrer">compat-table项目地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="_6-5-babel插件开发"><a href="#_6-5-babel插件开发" class="header-anchor">#</a> 6-5 babel插件开发</h2> <h3 id="babel插件开发的本质"><a href="#babel插件开发的本质" class="header-anchor">#</a> babel插件开发的本质</h3> <p>从代码到AST
将代码转换成AST树形结构</p> <p><img src="https://cdn.nlark.com/yuque/0/2020/png/2362456/1609331760463-65659d84-e438-43bf-8f24-ca31a3eb9636.png#align=left&amp;display=inline&amp;height=525&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1050&amp;originWidth=1896&amp;size=643594&amp;status=done&amp;style=none&amp;width=948" alt="image.png"></p> <h4 id="ast节点"><a href="#ast节点" class="header-anchor">#</a> AST节点</h4> <ol><li>AST每一层都拥有相同的结构，我们称之为节点</li> <li>一个AST可以由单一的节点或者成百上千个节点构成</li> <li>他们组合在一起可以描述用于静态分析的程序语法</li></ol> <p><img src="https://cdn.nlark.com/yuque/0/2020/png/2362456/1609331960378-1a945ec9-61ce-40dd-8806-c21c3701eeb9.png#align=left&amp;display=inline&amp;height=464&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=928&amp;originWidth=738&amp;size=240602&amp;status=done&amp;style=none&amp;width=369" alt="image.png"></p> <h4 id="babel也是编译器"><a href="#babel也是编译器" class="header-anchor">#</a> babel也是编译器</h4> <p>输入高版本ES代码，输出符合我们要求的低版本ES代码，例如：ES7-》ES5</p> <h4 id="babel的工作步骤-2"><a href="#babel的工作步骤-2" class="header-anchor">#</a> babel的工作步骤</h4> <p>根据babel文档，工作步骤主要分为3步</p> <ol><li>解析：解析代码，生成AST</li> <li>变换：操作AST，修改内容</li> <li>生成：根据AST生成新的代码</li></ol> <h4 id="访问者模式"><a href="#访问者模式" class="header-anchor">#</a> 访问者模式</h4> <p>转换AST：先对它进行递归的树形遍历
遍历AST的过程，就是不断的访问各个节点的过程
babel的插件使用了访问者模式，有2次访问的机会，一个是进入（向下遍历）的时候，一个是出去（遍历到最后向上返回）的时候
<img src="https://cdn.nlark.com/yuque/0/2020/png/2362456/1609333230949-db6fd4c7-39e4-4f3f-9a83-cc636d797678.png#align=left&amp;display=inline&amp;height=281&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=562&amp;originWidth=744&amp;size=187098&amp;status=done&amp;style=none&amp;width=372" alt="image.png">
访问者模式都自带两个参数，path和state
path是我们对节点的引用
<img src="https://cdn.nlark.com/yuque/0/2020/png/2362456/1609333649266-998e7643-65b6-48cd-b0d0-83f7c5577962.png#align=left&amp;display=inline&amp;height=280&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=560&amp;originWidth=1704&amp;size=273921&amp;status=done&amp;style=none&amp;width=852" alt="image.png">
state 插件的状态
比如plugin的信息、plugin传入的配置参数、甚至处理过程中的自定义状态
（左边图配置信息，右边图在babel中如何取到）
<img src="https://cdn.nlark.com/yuque/0/2020/png/2362456/1609333833715-9c8d5427-3fe0-4d09-a93a-bba26baface5.png#align=left&amp;display=inline&amp;height=222&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=444&amp;originWidth=1630&amp;size=271622&amp;status=done&amp;style=none&amp;width=815" alt="image.png">
babel插件的完整结构
<img src="https://cdn.nlark.com/yuque/0/2020/png/2362456/1609334180268-e787aa47-fb64-478b-b2e2-21a5c33264ac.png#align=left&amp;display=inline&amp;height=409&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=818&amp;originWidth=1888&amp;size=479217&amp;status=done&amp;style=none&amp;width=944" alt="image.png"></p> <h4 id="babel插件的开发工具"><a href="#babel插件的开发工具" class="header-anchor">#</a> babel插件的开发工具</h4> <p><img src="https://cdn.nlark.com/yuque/0/2020/png/2362456/1609334227797-45720e4d-b324-4be1-8614-c8c44abe49ad.png#align=left&amp;display=inline&amp;height=372&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=744&amp;originWidth=1656&amp;size=664462&amp;status=done&amp;style=none&amp;width=828" alt="image.png">
1、对比转换前和转换后的AST结构区别
todo：自己写一个bable插件</p> <h2 id="_6-6-webpack设计思想"><a href="#_6-6-webpack设计思想" class="header-anchor">#</a> 6-6 webpack设计思想</h2> <h3 id="tapable插件体系"><a href="#tapable插件体系" class="header-anchor">#</a> Tapable插件体系</h3> <p>webpack本身有很多hook钩子，插件注册自己感兴趣的hook，webpack在相应的时机调用他们。tapable提供了这样一个插件体系。
<img src="https://cdn.nlark.com/yuque/0/2020/png/2362456/1609373631738-a468c6ce-e354-4728-9670-392d8fec946c.png#align=left&amp;display=inline&amp;height=258&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=516&amp;originWidth=994&amp;size=544867&amp;status=done&amp;style=none&amp;width=497" alt="image.png">
Tapable的使用</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>SyncHook<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token function">require</span><span class="token punctuation">(</span>'tapable<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//创建实例</span>
<span class="token keyword">const</span> syncHook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//注册事件</span>
syncHook<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>age</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>name<span class="token punctuation">,</span>age<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
syncHook<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>age</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span>name<span class="token punctuation">,</span>age<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
syncHook<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>age</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">,</span>name<span class="token punctuation">,</span>age<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//调用</span>
<span class="token function">syncHook</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'harry potter'</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//输出</span>
<span class="token comment">//1 harry potter  18</span>
<span class="token comment">//2 harry potter  18</span>
<span class="token comment">//3 harry potter  18</span>
</code></pre></div><h3 id="webpack工作流程"><a href="#webpack工作流程" class="header-anchor">#</a> webpack工作流程</h3> <ol><li>初始化配置（webpak配置初始化，tapable体系初始化，主要初始化compiler对象）</li> <li>准备工作（初始化plugin等。初始化plugin的过程就是依次调用plugin的apply的方法的过程。plugin的apply方法就是在实例化compiler对象上注册每个钩子的回调函数）</li> <li>resolve源文件，构建module（遍历各个源文件构建module）</li> <li>生成chunk</li> <li>构建资源</li> <li>最终文件生成</li></ol> <p>说明：从第三步之后的每一步都有plugin注册hook函数的方式参与</p> <h2 id="_6-6-webpack主要概念"><a href="#_6-6-webpack主要概念" class="header-anchor">#</a> 6-6 webpack主要概念</h2> <p>entry：webpack分析依赖的入口，可以有多个
output：用来指示webpack将打包后的bundle文件放在什么位置
loader：能够让webpack处理非js/json的文件，将一切非js的文件转换为js模块，以便webpack分析依赖关系。
plugin：插件负责提供更高级的构建、打包工作。
mode：指明当前的构建任务所处的环境，让webpack针对特定环境启动一些优化项</p> <p>webpack.config.js webpack的配置文件：指示webpack干哪些活，当运行webpack指令时，加载里面的配置。所有构建工具都是基于nodejs平台运行的。模块化默认采用commonjs。</p> <h3 id="打包样式资源"><a href="#打包样式资源" class="header-anchor">#</a> 打包样式资源</h3> <p>webpack只能识别js文件，想要处理其他文件需要通过loader进行处理</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//webpack.config.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>resolve<span class="token punctuation">}</span> <span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span> <span class="token comment">//nodejs的方法</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token comment">//文件入口</span>
    entry<span class="token operator">:</span><span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span><span class="token punctuation">{</span>
        filename<span class="token operator">:</span><span class="token string">'build.js'</span><span class="token punctuation">,</span><span class="token comment">//输出的文件名</span>
        <span class="token comment">//__dirname nodejs的变量，代表当前文件目录的绝对路径</span>
        path<span class="token operator">:</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dist'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span><span class="token punctuation">{</span>
        rules<span class="token operator">:</span><span class="token punctuation">[</span><span class="token comment">//loader的配置</span>
            <span class="token punctuation">{</span><span class="token comment">//对命中的匹配的文件进行解析</span>
                test<span class="token operator">:</span><span class="token regex">/\.css$/</span><span class="token punctuation">,</span><span class="token comment">//正则匹配</span>
                <span class="token comment">//使用哪些loader</span>
                use<span class="token operator">:</span><span class="token punctuation">[</span><span class="token comment">//loader执行顺序从右到左，从下到上</span>
                    <span class="token comment">//创建style标签，将js的样式资源插入进去，添加到head中生效</span>
                    <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
                    <span class="token comment">//将css文件变成commonjs模块加载js中，里面的内容是样式字符串</span>
                    <span class="token string">'css-loader'</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">//模式</span>
    mode<span class="token operator">:</span><span class="token string">'development'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//index.js文件</span>
<span class="token comment">//引入样式资源</span>
<span class="token keyword">import</span> <span class="token string">'./index.css'</span>

</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i webpack  webpack-cli -D
<span class="token function">npm</span> i css-loader style-loder -D
<span class="token function">npm</span> i <span class="token function">less</span> less-loader -D

</code></pre></div><p>整个解析流程
1、从入口 entry-》index.js
2、index.js中遇到 引入的index.css样式文件，通过loader进行解析</p> <h3 id="打包html资源"><a href="#打包html资源" class="header-anchor">#</a> 打包html资源</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>resolve<span class="token punctuation">}</span> <span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span> <span class="token comment">//nodejs的path方法</span>
<span class="token keyword">const</span> htmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token comment">//文件入口</span>
    entry<span class="token operator">:</span><span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span><span class="token punctuation">{</span>
        filename<span class="token operator">:</span><span class="token string">'build.js'</span><span class="token punctuation">,</span><span class="token comment">//输出的文件名</span>
        path<span class="token operator">:</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dist'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token comment">//。。。</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span><span class="token punctuation">[</span><span class="token comment">//插件需要先引用再使用</span>
        <span class="token comment">//plugins的配置</span>
        <span class="token comment">//html-webpack-plugin</span>
        <span class="token keyword">new</span> <span class="token class-name">htmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            template<span class="token operator">:</span><span class="token string">'./src/index.html'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token comment">//。。。</span>
<span class="token punctuation">}</span>
</code></pre></div><p>功能：默认会创建一个空的html，自动引入输出的的所有资源（css/js）。当前的配置会将打包后的build.js引入。</p> <h3 id="打包图片资源"><a href="#打包图片资源" class="header-anchor">#</a> 打包图片资源</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>resolve<span class="token punctuation">}</span> <span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span> <span class="token comment">//nodejs的path方法</span>
<span class="token keyword">const</span> htmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token comment">//文件入口</span>
    entry<span class="token operator">:</span><span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span><span class="token punctuation">{</span>
        publicPath<span class="token operator">:</span> <span class="token string">'./'</span><span class="token punctuation">,</span><span class="token comment">//指定资源的公共路径</span>
        filename<span class="token operator">:</span><span class="token string">'build.js'</span><span class="token punctuation">,</span><span class="token comment">//输出的文件名</span>
        path<span class="token operator">:</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dist'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span><span class="token punctuation">{</span>
        rules<span class="token operator">:</span><span class="token punctuation">[</span><span class="token comment">//loader的配置</span>
            <span class="token comment">//...css,less配置忽略</span>
             <span class="token punctuation">{</span><span class="token comment">//对命中的匹配的文件进行解析</span>
                test<span class="token operator">:</span><span class="token regex">/\.(png|jpg|jpeg|gif)$/</span><span class="token punctuation">,</span>
                <span class="token comment">//使用哪些loader</span>
                <span class="token comment">//下载url-loader、file-loader（url-loader依赖于他）</span>
                loader<span class="token operator">:</span><span class="token string">'url-loader'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">//图片大小于8kb会被转换成base64</span>
                    limit<span class="token operator">:</span><span class="token number">8</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">,</span>
                    name<span class="token operator">:</span><span class="token string">'[hash:10].[ext]'</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
    
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
                test<span class="token operator">:</span><span class="token regex">/\.html$/</span><span class="token punctuation">,</span>
                <span class="token comment">//处理html文件中的img图片（负责引入img，从而能被url-loader进行处理）</span>
                <span class="token comment">//需要配置一个publicPath，指定访问的公共路径</span>
                loader<span class="token operator">:</span><span class="token string">'html-loader'</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    plugins<span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">htmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            template<span class="token operator">:</span><span class="token string">'./src/index.html'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在option中配置limit，图片大小于8kb会被转换成base64。
优点：减少请求数量（减轻服务器压力）
缺点：图片体积会更大（文件请求速度更慢）
name  名字取10位hash值加扩展名
如果图片在项目中被引用多次，也不会被打包多次</p> <h3 id="打包其他资源"><a href="#打包其他资源" class="header-anchor">#</a> 打包其他资源</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//。。。</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
  <span class="token comment">//。。。。</span>
    module<span class="token operator">:</span><span class="token punctuation">{</span>
        rules<span class="token operator">:</span><span class="token punctuation">[</span><span class="token comment">//loader的配置</span>
       <span class="token comment">//。。。。</span>
            <span class="token punctuation">{</span><span class="token comment">//打包其他资源（除了html/js/css资源以外的资源，loader中又要匹配的都要一一排除）</span>
                exclude<span class="token operator">:</span><span class="token regex">/\.(css|js|html)$/</span><span class="token punctuation">,</span>
                loader<span class="token operator">:</span><span class="token string">'file-loader'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span><span class="token punctuation">{</span>
                    name<span class="token operator">:</span><span class="token string">'[hash:10].[ext]'</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">//。。。。</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="devserver"><a href="#devserver" class="header-anchor">#</a> devserver</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>resolve<span class="token punctuation">}</span> <span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span> <span class="token comment">//nodejs的path方法</span>
<span class="token keyword">const</span> htmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
   
    devServer<span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token comment">//项目构建后路径</span>
        contentBase<span class="token operator">:</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">//开启giz压缩</span>
        compress<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token comment">//端口号</span>
        port<span class="token operator">:</span><span class="token number">8080</span><span class="token punctuation">,</span>
        <span class="token comment">//自动打开浏览器</span>
        open<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre></div><p>开发服务器  devserver:自动编译，自动打开浏览器，自动刷新浏览器
特点：只会在内存中编译打包，不会有任何输出
启动devServer指令为 npx webpack-dev-server （webpack5中 为 npx webpack server，但是目前有兼容问题，建议用webpack4.x）</p> <h3 id="开发环境配置（总结）"><a href="#开发环境配置（总结）" class="header-anchor">#</a> 开发环境配置（总结）</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>resolve<span class="token punctuation">}</span> <span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span> <span class="token comment">//nodejs的path方法</span>
<span class="token keyword">const</span> htmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token comment">//文件入口</span>
    entry<span class="token operator">:</span><span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span><span class="token punctuation">{</span>
        publicPath<span class="token operator">:</span> <span class="token string">'./'</span><span class="token punctuation">,</span>
        filename<span class="token operator">:</span><span class="token string">'js/build.js'</span><span class="token punctuation">,</span><span class="token comment">//输出的文件名，输出到打包路径的js文件下</span>
        <span class="token comment">//__dirname nodejs的变量，代表当前文件目录的绝对路径</span>
        path<span class="token operator">:</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dist'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span><span class="token punctuation">{</span>
        rules<span class="token operator">:</span><span class="token punctuation">[</span><span class="token comment">//loader的配置</span>
            <span class="token punctuation">{</span><span class="token comment">//对命中的匹配的文件进行解析</span>
                test<span class="token operator">:</span><span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
                <span class="token comment">//使用哪些loader</span>
                use<span class="token operator">:</span><span class="token punctuation">[</span><span class="token comment">//执行顺序从右到左，从下到上</span>
                    <span class="token comment">//创建style标签，将js的样式资源插入进去，添加到head中生效</span>
                    <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
                    <span class="token comment">//将css文件变成commonjs模块加载js中，里面的内容是样式字符串</span>
                    <span class="token string">'css-loader'</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span><span class="token comment">//对命中的匹配的文件进行解析</span>
                test<span class="token operator">:</span><span class="token regex">/\.less$/</span><span class="token punctuation">,</span>
                <span class="token comment">//使用哪些loader</span>
                use<span class="token operator">:</span><span class="token punctuation">[</span><span class="token comment">//执行顺序从右到左，从下到上</span>
                    <span class="token comment">//创建style标签，将js的样式资源插入进去，添加到head中生效</span>
                    <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
                    <span class="token comment">//将css文件变成commonjs模块加载js中，里面的内容是样式字符串</span>
                    <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
                    <span class="token comment">//将less转换成css</span>
                    <span class="token string">'less-loader'</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
             <span class="token punctuation">{</span><span class="token comment">//对命中的匹配的文件进行解析</span>
                test<span class="token operator">:</span><span class="token regex">/\.(png|jpg|jpeg|gif)$/</span><span class="token punctuation">,</span>
                <span class="token comment">//使用哪些loader</span>
                <span class="token comment">//下载url-loader、file-loader（url-loader依赖于他）</span>
                loader<span class="token operator">:</span><span class="token string">'url-loader'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">//图片大小于8kb会被转换成base64</span>
                    <span class="token comment">//优点：减少请求数量（减轻服务器压力）</span>
                    <span class="token comment">//缺点：图片体积会更大（文件请求速度更慢）</span>
                    limit<span class="token operator">:</span><span class="token number">8</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">,</span>
                    name<span class="token operator">:</span><span class="token string">'[hash:10].[ext]'</span><span class="token punctuation">,</span>
                    outputPath<span class="token operator">:</span><span class="token string">'imgs'</span>  <span class="token comment">//输出到打包目录的imgs的路径下</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
    
            <span class="token punctuation">}</span>
            <span class="token punctuation">,</span><span class="token punctuation">{</span>
                test<span class="token operator">:</span><span class="token regex">/\.html$/</span><span class="token punctuation">,</span>
                <span class="token comment">//处理html文件中的img图片（负责引入img，从而能被url-loader进行处理）</span>
                <span class="token comment">//需要配置一个publicPath，指定访问的公共路径</span>
                loader<span class="token operator">:</span><span class="token string">'html-loader'</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
            <span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token comment">//打包其他资源（除了html/js/css资源以外的资源）</span>
                exclude<span class="token operator">:</span><span class="token regex">/\.(css|less|js|html|png|jpg|jpeg|gif)$/</span><span class="token punctuation">,</span>
                loader<span class="token operator">:</span><span class="token string">'file-loader'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span><span class="token punctuation">{</span>
                    name<span class="token operator">:</span><span class="token string">'[hash:10].[ext]'</span><span class="token punctuation">,</span>
                    outputPath<span class="token operator">:</span><span class="token string">'media'</span>  
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    plugins<span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token comment">//plugins的配置</span>
        <span class="token comment">//html-webpack-plugin</span>
        <span class="token comment">//功能：默认会创建一个空的html，自动引入输出的的所有资源（css/js）</span>
        <span class="token keyword">new</span> <span class="token class-name">htmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            template<span class="token operator">:</span><span class="token string">'./src/index.html'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    
    <span class="token comment">//模式</span>
    mode<span class="token operator">:</span><span class="token string">'development'</span><span class="token punctuation">,</span>

    <span class="token comment">//开发服务器  devserver:自动编译，自动打开浏览器，自动刷新浏览器</span>
    <span class="token comment">//特点：只会在内存中编译打包，不会有任何输出</span>
    <span class="token comment">//启动devServer指令为 npx webpack devser </span>
    devServer<span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token comment">//项目构建后路径</span>
        contentBase<span class="token operator">:</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">//开启giz压缩</span>
        compress<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token comment">//端口号</span>
        port<span class="token operator">:</span><span class="token number">8080</span><span class="token punctuation">,</span>
        <span class="token comment">//自动打开浏览器</span>
        open<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>1、通过output、outputPath来指定输出的路径
2、css由于使用了css-loader会将css提取到js中，一起打包在js文件里</p> <h3 id="构建环境介绍"><a href="#构建环境介绍" class="header-anchor">#</a> 构建环境介绍</h3> <p>目前开发环境配置的问题
1、css样式文件是通过css-loader插入到js文件中的，这样会导致js文件的体积较大，下载速度很慢。由于是先加载js，然后通过创建style标签插入到页面中，会造成闪屏现象。
解决：将css代码提取出来
2、对代码进行压缩处理
3、css需要加一些兼容，加前缀
说明：由于以上处理比较费时，都放在开发环境里处理</p> <h3 id="生产环境-提取css文件成单独文件"><a href="#生产环境-提取css文件成单独文件" class="header-anchor">#</a> 生产环境-提取css文件成单独文件</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>resolve<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mini-css-extract-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token comment">//...</span>
    module<span class="token operator">:</span><span class="token punctuation">{</span>
        rules<span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span><span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
                use<span class="token operator">:</span><span class="token punctuation">[</span>
                    <span class="token comment">//创建style标签，将样式放入</span>
                    <span class="token comment">// 'style-loader',</span>
                   <span class="token comment">//**这个loader取代style-loader。作用：提取js中的css成单独文件</span>
                    MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>
                     <span class="token comment">//将css文件整合到js中</span>
                    <span class="token string">'css-loader'</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            template<span class="token operator">:</span><span class="token string">'./src/index.html'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            filename<span class="token operator">:</span><span class="token string">'css/build.css'</span> <span class="token comment">//**对输出的css进行重命名</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    mode<span class="token operator">:</span><span class="token string">'development'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>1、MiniCssExtractPlugin.loader取代style-loader。作用：提取js中的css成单独文件。
打包后的结果</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>css/build.css<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>通过link标签引入，不再通过style标签引入。不会出现闪屏现象。css文件和js文件分开了，js文件的体积变小了，解析速度也变快了。</p> <h3 id="css兼容性处理"><a href="#css兼容性处理" class="header-anchor">#</a> css兼容性处理</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>resolve<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mini-css-extract-plugin'</span><span class="token punctuation">)</span>
<span class="token comment">//设置 nodejs环境变量</span>
process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">=</span> <span class="token string">'development'</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    entry<span class="token operator">:</span><span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span><span class="token punctuation">{</span>
        filename<span class="token operator">:</span><span class="token string">'js/built.js'</span><span class="token punctuation">,</span>
        path<span class="token operator">:</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'build'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span><span class="token punctuation">{</span>
        rules<span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span><span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
                use<span class="token operator">:</span><span class="token punctuation">[</span>
                    MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>
                     <span class="token comment">//将css文件整合到js中</span>
                    <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
                    <span class="token comment">/**
                     * css兼容性处理：会自动读取postcss.config.js中的配置
                     */</span>
                    <span class="token string">'postcss-loader'</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token comment">//...</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            template<span class="token operator">:</span><span class="token string">'./src/index.html'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token comment">//对输出的css进行重命名</span>
            filename<span class="token operator">:</span><span class="token string">'css/build.css'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    mode<span class="token operator">:</span><span class="token string">'development'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>     
</code></pre></div><p>postcss.config.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    plugins<span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token punctuation">[</span>
            <span class="token string">&quot;postcss-preset-env&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token comment">//options</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>css样式</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">#box1</span><span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> blueviolet<span class="token punctuation">;</span>
    <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
    <span class="token property">backface-visibility</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>打包后，自动增加了前缀</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">#box1</span><span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> blueviolet<span class="token punctuation">;</span>
    <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
    <span class="token property">-webkit-backface-visibility</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
            <span class="token property">backface-visibility</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>疑问：如果设置根据浏览器版本进行兼容
<a href="https://www.dazhuanlan.com/2020/03/12/5e69f574c1bef/" target="_blank" rel="noopener noreferrer">https://www.dazhuanlan.com/2020/03/12/5e69f574c1bef/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="压缩css"><a href="#压缩css" class="header-anchor">#</a> 压缩css</h3> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">//...
const OptimizeCssAssetsWebpackPlugin = require('optimize-css-assets-webpack-plugin')

//设置 nodejs环境变量
process.env.NODE_ENV = 'development'
module.exports=</span><span class="token punctuation">{</span>
   //...
    <span class="token property">plugins</span><span class="token punctuation">:</span>[
        //...
        new <span class="token function">OptimizeCssAssetsWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>//压缩css
    ]<span class="token punctuation">,</span>
    <span class="token property">mode</span><span class="token punctuation">:</span><span class="token string">'development'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>对css文件进行压缩，把css压缩成一行。体积也有减少。</p> <h3 id="压缩html和js"><a href="#压缩html和js" class="header-anchor">#</a> 压缩html和js</h3> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">const</span> <span class="token punctuation">{</span>resolve<span class="token punctuation">}</span> <span class="token selector">= require('path')
const HtmlWebpackPlugin = require('html-webpack-plugin')
const OptimizeCssAssetsWebpackPlugin = require('optimize-css-assets-webpack-plugin')

//设置 nodejs环境变量
process.env.NODE_ENV = 'development'
module.exports=</span><span class="token punctuation">{</span>
		<span class="token selector">//...	
    plugins:[
        new HtmlWebpackPlugin(</span><span class="token punctuation">{</span>
            <span class="token selector">template:'./src/index.html',
            minify:</span><span class="token punctuation">{</span>
                <span class="token property">collapseWhitespace</span><span class="token punctuation">:</span>true<span class="token punctuation">,</span>//移除空格
                <span class="token property">removeComments</span><span class="token punctuation">:</span>true<span class="token punctuation">,</span>//移除注释
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token selector">),
        new MiniCssExtractPlugin(</span><span class="token punctuation">{</span>
            //对输出的css进行重命名
            <span class="token property">filename</span><span class="token punctuation">:</span><span class="token string">'css/build.css'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        new <span class="token function">OptimizeCssAssetsWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    ]<span class="token punctuation">,</span>
    //生产环境下会自动压缩js代码
    <span class="token property">mode</span><span class="token punctuation">:</span><span class="token string">'production'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>1、压缩js代码：只要开启生产环境，就会自动压缩代码。
2、压缩html代码：通过minify选项，把html代码压缩成一行。html标签不需要进行兼容性处理。</p> <h3 id="生产环境基本配置（总结）"><a href="#生产环境基本配置（总结）" class="header-anchor">#</a> 生产环境基本配置（总结）</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>resolve<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mini-css-extract-plugin'</span><span class="token punctuation">)</span><span class="token comment">//把css单独提取成文件</span>
<span class="token keyword">const</span> OptimizeCssAssetsWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'optimize-css-assets-webpack-plugin'</span><span class="token punctuation">)</span> <span class="token comment">//压缩css</span>

<span class="token comment">// // 定义nodejs环境变量：决定使用browserlist的哪个环境(eslint中用到)</span>
<span class="token comment">// process.env.NODE_ENV='production';</span>

<span class="token comment">//复用loader</span>
<span class="token keyword">const</span> commonCssLoader<span class="token operator">=</span><span class="token punctuation">[</span>
     <span class="token comment">//创建style标签，将样式放入</span>
     <span class="token comment">// 'style-loader',</span>
     <span class="token comment">//这个loader取代style-loader。作用：提取js中的css成单独文件</span>
     MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>
    <span class="token comment">//将css文件整合到js中</span>
    <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
     <span class="token comment">/**
     * css兼容性处理：npm install --save-dev postcss-loader postcss
     */</span>
    <span class="token string">'postcss-loader'</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">//设置 nodejs环境变量</span>
process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">=</span> <span class="token string">'development'</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    entry<span class="token operator">:</span><span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span><span class="token punctuation">{</span>
        filename<span class="token operator">:</span><span class="token string">'js/built.js'</span><span class="token punctuation">,</span>
        path<span class="token operator">:</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'build'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span><span class="token punctuation">{</span>
        rules<span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span><span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
                use<span class="token operator">:</span><span class="token punctuation">[</span><span class="token operator">...</span>commonCssLoader<span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span><span class="token regex">/\.less$/</span><span class="token punctuation">,</span>
                use<span class="token operator">:</span><span class="token punctuation">[</span><span class="token operator">...</span>commonCssLoader<span class="token punctuation">,</span><span class="token string">'less-loader'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">/*
                正常来讲，一个文件只能被一个loader处理
                当一个文件要被多个loader处理，那么一定要指定loader执行的先后顺序：
                先执行eslint再执行babel
            */</span>
            <span class="token comment">// {</span>
            <span class="token comment">//     //在package.json中eslintConfig --&gt; airbnb</span>
            <span class="token comment">//     test:/\.js$/,</span>
            <span class="token comment">//     exclude:/node_modules/,</span>
            <span class="token comment">//     //优先执行</span>
            <span class="token comment">//     enforce:'pre',</span>
            <span class="token comment">//     loader:'eslint-loader',</span>
            <span class="token comment">//     options:{</span>
            <span class="token comment">//         fix:true,</span>
            <span class="token comment">//     },</span>
            <span class="token comment">// },</span>
            <span class="token comment">//npm install -D babel-loader @babel/core @babel/preset-env webpack</span>
            <span class="token punctuation">{</span>
                <span class="token comment">//对js做兼容性处理</span>
                test<span class="token operator">:</span><span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
                exclude<span class="token operator">:</span><span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
                loader<span class="token operator">:</span><span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span><span class="token punctuation">{</span>
                    presets<span class="token operator">:</span><span class="token punctuation">[</span>
                        <span class="token string">'@babel/preset-env'</span>
                    <span class="token punctuation">]</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span><span class="token regex">/\.(jpg|png|gif)$/</span><span class="token punctuation">,</span>
                loader<span class="token operator">:</span><span class="token string">'url-loader'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span><span class="token punctuation">{</span>
                    limit<span class="token operator">:</span><span class="token number">8</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">,</span>
                    name<span class="token operator">:</span><span class="token string">'[hash:10].[ext]'</span><span class="token punctuation">,</span>
                    outputPath<span class="token operator">:</span><span class="token string">'imgs'</span><span class="token punctuation">,</span>
                    esModule<span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span><span class="token comment">//处理html中的图片</span>
                test<span class="token operator">:</span><span class="token regex">/\.html$/</span><span class="token punctuation">,</span>
                loader<span class="token operator">:</span><span class="token string">'html-loader'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                exclude<span class="token operator">:</span><span class="token regex">/\.(js|css|less|html|jpg|png|gif)/</span><span class="token punctuation">,</span>
                loader<span class="token operator">:</span><span class="token string">'file-loader'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span><span class="token punctuation">{</span>
                    outputPath<span class="token operator">:</span><span class="token string">'media'</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token comment">//html的压缩</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            template<span class="token operator">:</span><span class="token string">'./src/index.html'</span><span class="token punctuation">,</span>
            minify<span class="token operator">:</span><span class="token punctuation">{</span>
                collapseWhitespace<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//移除空格</span>
                removeComments<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//移除注释</span>
            <span class="token punctuation">}</span>
        
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">//css的提取</span>
        <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token comment">//对输出的css进行重命名</span>
            filename<span class="token operator">:</span><span class="token string">'css/build.css'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">//css的压缩</span>
        <span class="token keyword">new</span> <span class="token class-name">OptimizeCssAssetsWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">//生产环境下会自动压缩js代码</span>
    mode<span class="token operator">:</span><span class="token string">'production'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>1、压缩js、css、图片文件
2、js语法转换（es6及以上的语法）、css兼容性处理</p> <h3 id="性能优化介绍"><a href="#性能优化介绍" class="header-anchor">#</a> 性能优化介绍</h3> <h4 id="开发环境性能优化"><a href="#开发环境性能优化" class="header-anchor">#</a> 开发环境性能优化</h4> <ul><li><p>优化打包构建速度</p> <div class="language- extra-class"><pre><code>HMR
</code></pre></div></li> <li><p>优化代码调试</p> <div class="language- extra-class"><pre><code>source-map
</code></pre></div></li></ul> <h4 id="生产环境性能优化"><a href="#生产环境性能优化" class="header-anchor">#</a> 生产环境性能优化</h4> <ul><li>优化打包构建速度</li></ul> <p>oneof
babel缓存（优化构建速度）
多进程打包<br>
externals（不打包，使用cdn）
dll（单独打包好第三方库直接用）</p> <ul><li>优化代码运行的性能</li></ul> <p>缓存（hash｜chunkhash｜contenthash）
tree shaking
code split
懒加载/预加载
pwa</p> <h3 id="hmr"><a href="#hmr" class="header-anchor">#</a> HMR</h3> <h4 id="背景"><a href="#背景" class="header-anchor">#</a> 背景</h4> <p>自动编译在开发环境通过<code>npx webpack-dev-server</code>启动
存在的问题：
在没有开启XHR之前，修改了css文件js文件也会被重新打包。一个模块发生变换，其他都重新打包了。浪费资源，如果模块比较多的时候，会导致速度变慢。
解决：
开启HMR热模块替换</p> <h4 id="hmr如何开启"><a href="#hmr如何开启" class="header-anchor">#</a> HMR如何开启</h4> <p>启用这个功能很简单, 只需要修改一下 webpack.config.js 的配置, 使用 webpack 内置的 HMR 插件就可以了**</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//webpack.config.js</span>
devServer<span class="token operator">:</span><span class="token punctuation">{</span>
     <span class="token comment">//项目构建后路径</span>
     contentBase<span class="token operator">:</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token comment">//开启giz压缩</span>
     compress<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
     <span class="token comment">//端口号</span>
     port<span class="token operator">:</span><span class="token number">8080</span><span class="token punctuation">,</span>
     <span class="token comment">//自动打开浏览器</span>
     open<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
     <span class="token comment">//***开启HMR***</span>
     hot<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>HMR:hot module replacement 热模块替换/模块热替换
作用：一个模块发生变化，只会重新打包这一个模块（而不是打包所有模块）
极大提升构建速度</p> <ul><li>样式文件：可以使用HMR功能：因为style-loader 内部实现了（需要在loader中用style-loader处理）</li> <li>js文件：默认不能使用HMR功能（需要修改js代码，支持HMR）</li></ul> <p>** 注意：HMR功能对js处理，只能处理非入口js文件的其他文件**</p> <ul><li>html文件：默认不能使用HMR功能，同时会导致问题：html文件不能热更新了（html开发的时候只有一个文件，不用做HMR功能，改变的时候都变了）</li></ul> <p><strong>解决：修改entry入口，将html文件引入</strong></p> <p><strong>html启用热更新</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>entry<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'./src/index.js'</span><span class="token punctuation">,</span><span class="token string">'./src/index.html'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p><strong>js启用热更新</strong>
启用 webpack 内置的 HMR插件后, module.hot 接口就会暴露在 index.js 中, 接下来需要在 index.js 中配置告诉 webpack 接受HMR的模块( print.js ):</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//index.js中监听引入的依赖文件</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>hot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//一旦module.hot为true，说明开启了HMR功能。=》让HMR功能代码生效</span>
    module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token string">'./print.js'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
      <span class="token comment">//方法会监听print.js文件的变化，一旦发生变化，其他默认不会重新打包构建</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Accepting the updated printMe module!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//会执行后面的回调函数</span>
        <span class="token function">printMe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="sourcemap"><a href="#sourcemap" class="header-anchor">#</a> sourcemap</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code> <span class="token comment">//webpack.config.js</span>
devtool<span class="token operator">:</span><span class="token string">'source-map'</span>
</code></pre></div><p>sourcemap是一种 提供源代码到构建后代码映射技术（如果构建后代码出错了，通过映射可以追踪代码错误）
[inline-|hidden-|eval-][nosources-][cheap-[module-]]source-map</p> <ul><li>source-map：外部</li></ul> <p>错误代码准确信息 和源代码的错误位置</p> <ul><li>inline-source-map：内联</li></ul> <p>只生成一个内联source-map
错误代码准确信息和源代码的错误位置</p> <ul><li>hidden-source-map：外部</li></ul> <p>错误代码错误原因，但是没有错误位置
不能追踪源代码错误，只能提示到构建后代码的错误位置</p> <ul><li>eval-source-map：内联</li></ul> <p>每一个文件都生成对应的source-map，都在eval</p> <ul><li>nosources-source-map：外部</li></ul> <p>错误代码准确信息，但是没有任何源代码信息</p> <ul><li>cheap-source-map：外部</li></ul> <p>错误代码准确信息和源代码的错误位置
只能精确行</p> <ul><li>cheap-module-source-map：外部</li></ul> <p>错误代码准确信息和源代码的错误位置</p> <p>内联和外部的区别：1、外部生成了文件，内联没有 2、内联构建速度更快
开发环境：速度快，调试更友好
速度快（eval&gt;inline&gt;cheap&gt;...）
eval-cheap-source-map
eval-source-map
调试更友好
source-map
cheap-module-source-map
cheap-source-map</p> <p>--&gt; eval-source-map / eval-cheap-module-source-map（开发环境 选用eval-source-map）</p> <p>生产环境：源代码要不要隐蔽？调试要不要友好
内联会让体积变大，所以在生产环境不用内联
nosources-source-map 全部隐藏
hidden-source-map 只隐藏源代码，会提示构建后代码错误信息</p> <p>--&gt; source-map  / cheap-module-source-map （生产环境 选用source-map）</p> <h3 id="oneof"><a href="#oneof" class="header-anchor">#</a> oneof</h3> <p>提升构建速度，不用匹配多个loader</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  module<span class="token operator">:</span><span class="token punctuation">{</span>
        rules<span class="token operator">:</span><span class="token punctuation">[</span>
          <span class="token comment">//以下loader只会匹配一个</span>
          <span class="token comment">//注意：不能有两个配置处理同一种类型的文件（例如都处理js的laoder）</span>
            oneOf<span class="token punctuation">[</span>         
              <span class="token punctuation">{</span><span class="token comment">//对命中的匹配的文件进行解析</span>
                test<span class="token operator">:</span><span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
                <span class="token comment">//使用哪些loader</span>
                use<span class="token operator">:</span><span class="token punctuation">[</span><span class="token comment">//执行顺序从右到左，从下到上</span>
                    <span class="token comment">//创建style标签，将js的样式资源插入进去，添加到head中生效</span>
                    <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
                    <span class="token comment">//将css文件变成commonjs模块加载js中，里面的内容是样式字符串</span>
                    <span class="token string">'css-loader'</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token comment">//对命中的匹配的文件进行解析</span>
                test<span class="token operator">:</span><span class="token regex">/\.less$/</span><span class="token punctuation">,</span>
                <span class="token comment">//使用哪些loader</span>
                use<span class="token operator">:</span><span class="token punctuation">[</span><span class="token comment">//执行顺序从右到左，从下到上</span>
                    <span class="token comment">//创建style标签，将js的样式资源插入进去，添加到head中生效</span>
                    <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
                    <span class="token comment">//将css文件变成commonjs模块加载js中，里面的内容是样式字符串</span>
                    <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
                    <span class="token comment">//将less转换成css</span>
                    <span class="token string">'less-loader'</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="缓存"><a href="#缓存" class="header-anchor">#</a> 缓存</h3> <h4 id="babel缓存"><a href="#babel缓存" class="header-anchor">#</a> babel缓存</h4> <p>设置<code>cacheDirectory:true</code>
--&gt;让第二次打包构建速度更快</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//webpack.config.js</span>
<span class="token punctuation">{</span>
                <span class="token comment">//对js做兼容性处理</span>
                test<span class="token operator">:</span><span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
                exclude<span class="token operator">:</span><span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
                loader<span class="token operator">:</span><span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span><span class="token punctuation">{</span>
                    presets<span class="token operator">:</span><span class="token punctuation">[</span>
                        <span class="token string">'@babel/preset-env'</span><span class="token punctuation">,</span>
                        <span class="token punctuation">{</span>
                            useBuiltIns<span class="token operator">:</span><span class="token string">'usage'</span><span class="token punctuation">,</span>
                            corejs<span class="token operator">:</span><span class="token punctuation">{</span>version<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                            targets<span class="token operator">:</span><span class="token punctuation">{</span>
                                chrome<span class="token operator">:</span><span class="token string">'60'</span><span class="token punctuation">,</span>
                                firefox<span class="token operator">:</span><span class="token string">'50'</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token comment">//开启babel缓存</span>
                    <span class="token comment">//第二次构建时，会读取之前的缓存</span>
                    cacheDirectory<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="文件缓存"><a href="#文件缓存" class="header-anchor">#</a> 文件缓存</h4> <ul><li>hash：每次webpack构建时会生成一个唯一的hash值（不管文件有没有变化，只要构建了都会变）</li></ul> <p>问题：因为js和css同时使用一个hash值。如果重新打包，会导致所有缓存失效。（可能只改了一个文件）</p> <ul><li>chunkhash：根据chunk生成的hash值。如果打包来源同一个chunk，那么hash值一样</li></ul> <p>问题：js和css的hash值还一样的
因为css是在js中被引入的，所以同属于一个chunk</p> <ul><li>contenthash：根据文件的内容生成hash值。不同文件hash值一定不一样</li></ul> <p>--&gt; 让代码上线运行缓存更好使用</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>   output<span class="token operator">:</span><span class="token punctuation">{</span>
        filename<span class="token operator">:</span><span class="token string">'js/built.[contenthash:10].js'</span><span class="token punctuation">,</span>
        path<span class="token operator">:</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'build'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>  
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code> plugins<span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token comment">//...</span>
        <span class="token comment">//css的提取</span>
        <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token comment">//对输出的css进行重命名</span>
            filename<span class="token operator">:</span><span class="token string">'css/build.[contenthash:10].css'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="treeshaking"><a href="#treeshaking" class="header-anchor">#</a> treeshaking</h3> <p>tree shaking 去除无用的代码
前提：1.必须使用es6模块化  2.开启production环境
作用：减少代码体积</p> <p>在package.json中配置
“sideEffects”：false 所有代码都没有副作用 （都可以进行tree shaking）
问题：可能会把css/@babel/polyfill（副作用）文件干掉
“sideEffects”：[&quot;<em>.css&quot;,&quot;</em>.less&quot;]</p> <h3 id="code-split-代码分割"><a href="#code-split-代码分割" class="header-anchor">#</a> code split 代码分割</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code>   <span class="token comment">/*
    1.可以将node_modules中的代码单独打包一个chunk最终输出
    2.自动分析多入口chunk中，有没有公共的文件。如果有会打包成单独一个chunk
    **/</span>
    optimization<span class="token operator">:</span><span class="token punctuation">{</span>
        splitChunks<span class="token operator">:</span><span class="token punctuation">{</span>
            chunks<span class="token operator">:</span><span class="token string">'all'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/*
	通过js代码，让某个文件被单独打包成一个chunk
  import动态导入语法：能将某个文件单独打包
*/</span>
<span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./test'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>mul<span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文件被加载'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="懒加载和预加载"><a href="#懒加载和预加载" class="header-anchor">#</a> 懒加载和预加载</h3> <p>懒加载：当文件需要使用时才加载
预加载 prefetch：会在使用之前，提前加载js文件
正常加载可以人为是并行加载（同一个时间加载多个文件）
预加载 prefetch：等其他资源加载完毕，浏览器空闲了，在偷偷加载资源</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//懒加载实例</span>
<span class="token comment">//1.懒加载：点击的时候加载test</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/*webpackChunkName:'test'*/</span><span class="token string">'./test'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>mul<span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">mul</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">//2.预加载：在空闲时提前加载好test</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/*webpackChunkName:'test',webpackPrefetch:true*/</span><span class="token string">'./test'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>mul<span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">mul</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>多进程打包</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>npm i thread<span class="token operator">-</span>loader <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code> <span class="token punctuation">{</span>
                <span class="token comment">//对js做兼容性处理</span>
                test<span class="token operator">:</span><span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
                exclude<span class="token operator">:</span><span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
                use<span class="token operator">:</span><span class="token punctuation">[</span>
                    <span class="token comment">/*
                    开启多进程打包
                    进程启动大概为600ms，进程通信也有开销
                    只有工作消耗时间比较长，才需要多进程打包
                    */</span>
                    <span class="token punctuation">{</span>
                        loader<span class="token operator">:</span><span class="token string">'thread-loader'</span><span class="token punctuation">,</span>
                        options<span class="token operator">:</span><span class="token punctuation">{</span>
                            workers<span class="token operator">:</span><span class="token number">2</span><span class="token comment">//2个进程</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        loader<span class="token operator">:</span><span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
                        options<span class="token operator">:</span><span class="token punctuation">{</span>
                            <span class="token comment">//。。。</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="externals"><a href="#externals" class="header-anchor">#</a> externals</h3> <p>让一些包不打进去，通过cdn的方式引入。指示哪些包不打包</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//webpack.config.js</span>
mode<span class="token operator">:</span><span class="token string">'prodution'</span><span class="token punctuation">,</span>
externals<span class="token operator">:</span><span class="token punctuation">{</span>
<span class="token comment">//拒绝jQuery被打包进来</span>
  jquery：<span class="token string">'jQuery'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="dll"><a href="#dll" class="header-anchor">#</a> dll</h3> <p>单独打包第三方库，并自动引入。避免每次重复打包第三方库</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//webpack.config.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>resolve<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> AddAssetHtmlWebpackPlugin<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'add-asset-html-webpack-plugin'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
  entry<span class="token operator">:</span><span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span><span class="token punctuation">{</span>
  	filename<span class="token operator">:</span><span class="token string">'built.js'</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'build'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span><span class="token punctuation">[</span>
  	<span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    	template<span class="token operator">:</span><span class="token string">'./src/index.html'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">//告诉webpack哪些库不参与打包，同时使用时的名称也得变</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    	manifest<span class="token operator">:</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dll/manifest.json'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">//将某个文件打包输出去，并在html中自动引入该资源</span>
    <span class="token keyword">new</span> <span class="token class-name">AddAssetHtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    	filepath<span class="token operator">:</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dll/jquery.js'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  mode<span class="token operator">:</span><span class="token string">'production'</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//webpack.dll.js  用于单独打包第三方库</span>
<span class="token comment">/*
	使用dll技术，对某些库（第三方库：jquery、react、vue...）进行单独打包
  当你运行webpack时，默认查找webpack.config.js配置文件
  需求：需要运行webpack.dll.js文件
  --&gt;webpack  --config webpack.dll.js
*/</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>resolve<span class="token punctuation">}</span><span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
  entry<span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token comment">//最终打包生成的[name]--&gt;jquery</span>
    <span class="token comment">//['jquery']--&gt;要打包的库是jquery</span>
    jquery<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'jquery'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span><span class="token punctuation">{</span>
  	filename<span class="token operator">:</span><span class="token string">'[name].js'</span><span class="token punctuation">,</span><span class="token comment">//打包后的文件名</span>
    path<span class="token operator">:</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dll'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//打包后的文件路径</span>
    library<span class="token operator">:</span><span class="token string">'[name]_[hash]'</span> <span class="token comment">//打包的库里面向外暴露出去的内容叫什么名字</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span><span class="token punctuation">[</span>
  	<span class="token comment">//打包生成一个manifest.json文件 --&gt;提供和jquery映射</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    	name<span class="token operator">:</span><span class="token string">'[name]_[hash]'</span><span class="token punctuation">,</span><span class="token comment">//映射库的暴露的内容名称</span>
      path<span class="token operator">:</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dll/manifest.json'</span><span class="token punctuation">)</span><span class="token comment">//输出文件路径</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  mode<span class="token operator">:</span><span class="token string">'production'</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/webpack/splitCode.html" class="prev">
        代码分割
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.df490d21.js" defer></script><script src="/assets/js/2.9235f093.js" defer></script><script src="/assets/js/34.adb9aee5.js" defer></script>
  </body>
</html>
