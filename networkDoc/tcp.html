<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>TCP | 汪涵的博客</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link>
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.98136e72.css" as="style"><link rel="preload" href="/assets/js/app.df490d21.js" as="script"><link rel="preload" href="/assets/js/2.9235f093.js" as="script"><link rel="preload" href="/assets/js/23.e2151993.js" as="script"><link rel="prefetch" href="/assets/js/10.92f448a7.js"><link rel="prefetch" href="/assets/js/11.d81451ab.js"><link rel="prefetch" href="/assets/js/12.fe657e2d.js"><link rel="prefetch" href="/assets/js/13.673f55af.js"><link rel="prefetch" href="/assets/js/14.33419792.js"><link rel="prefetch" href="/assets/js/15.ab408685.js"><link rel="prefetch" href="/assets/js/16.41231623.js"><link rel="prefetch" href="/assets/js/17.f98cb10c.js"><link rel="prefetch" href="/assets/js/18.dc28497a.js"><link rel="prefetch" href="/assets/js/19.3bd23e42.js"><link rel="prefetch" href="/assets/js/20.48e0bcc4.js"><link rel="prefetch" href="/assets/js/21.4ca137be.js"><link rel="prefetch" href="/assets/js/22.fe35d04c.js"><link rel="prefetch" href="/assets/js/24.42cdd1be.js"><link rel="prefetch" href="/assets/js/25.2ef590fe.js"><link rel="prefetch" href="/assets/js/26.88fd7535.js"><link rel="prefetch" href="/assets/js/27.aefa961a.js"><link rel="prefetch" href="/assets/js/28.5b4073a9.js"><link rel="prefetch" href="/assets/js/29.4c27b4b2.js"><link rel="prefetch" href="/assets/js/3.74014b60.js"><link rel="prefetch" href="/assets/js/30.f97becd7.js"><link rel="prefetch" href="/assets/js/31.92fc7f70.js"><link rel="prefetch" href="/assets/js/32.d7c4f275.js"><link rel="prefetch" href="/assets/js/33.8d2027ca.js"><link rel="prefetch" href="/assets/js/34.adb9aee5.js"><link rel="prefetch" href="/assets/js/35.34cb4c23.js"><link rel="prefetch" href="/assets/js/4.ddf5fb83.js"><link rel="prefetch" href="/assets/js/5.2f6ceb2d.js"><link rel="prefetch" href="/assets/js/6.acebe267.js"><link rel="prefetch" href="/assets/js/7.4f5a488b.js"><link rel="prefetch" href="/assets/js/8.d3b85309.js"><link rel="prefetch" href="/assets/js/9.395837cf.js">
    <link rel="stylesheet" href="/assets/css/0.styles.98136e72.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">汪涵的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>计算机网络</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/networkDoc/" aria-current="page" class="sidebar-link">计算机网络</a></li><li><a href="/networkDoc/browserCache.html" class="sidebar-link">浏览器缓存</a></li><li><a href="/networkDoc/dns.html" class="sidebar-link">DNS</a></li><li><a href="/networkDoc/http.html" class="sidebar-link">http协议</a></li><li><a href="/networkDoc/https.html" class="sidebar-link">Https</a></li><li><a href="/networkDoc/iframe.html" class="sidebar-link">iframe</a></li><li><a href="/networkDoc/origin.html" class="sidebar-link">跨域</a></li><li><a href="/networkDoc/tcp.html" aria-current="page" class="active sidebar-link">TCP</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/networkDoc/tcp.html#tcp-2" class="sidebar-link">TCP</a></li><li class="sidebar-sub-header"><a href="/networkDoc/tcp.html#udp" class="sidebar-link">UDP</a></li><li class="sidebar-sub-header"><a href="/networkDoc/tcp.html#三次握手" class="sidebar-link">三次握手</a></li><li class="sidebar-sub-header"><a href="/networkDoc/tcp.html#四次挥手" class="sidebar-link">四次挥手</a></li><li class="sidebar-sub-header"><a href="/networkDoc/tcp.html#标识说明" class="sidebar-link">标识说明</a></li></ul></li><li><a href="/networkDoc/urlDesc.html" class="sidebar-link">输入一个url发生了什么</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>webpack</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="tcp"><a href="#tcp" class="header-anchor">#</a> TCP</h1> <h2 id="tcp-2"><a href="#tcp-2" class="header-anchor">#</a> TCP</h2> <ul><li>面向连接</li> <li>一对一通信</li> <li>面向字节流</li> <li>可靠传输，使用流量控制和拥塞控制</li> <li>报头最小20字节，最大60字节</li></ul> <h2 id="udp"><a href="#udp" class="header-anchor">#</a> UDP</h2> <p>无连接
支持一对一，一对多，多对一和多对多的通信
面向报文
不可靠传输，不使用流量控制和拥塞控制
报头开销小，仅8字节</p> <h2 id="三次握手"><a href="#三次握手" class="header-anchor">#</a> 三次握手</h2> <p>tcp连接是全双工的，数据在两个方向上能同时传递。
所以要确保双方，同时能发数据和收数据</p> <ul><li>第一次握手：建立连接。客户端发送连接请求报文段，将SYN位置为1，Sequence Number为x；然后，客户端进入SYN_SEND状态，等待服务器的确认；（客户端发送网络包，服务端收到了，服务端能得出结论：==客户端的发送能力、服务端的接收能力是正常的==。）</li> <li>第二次握手：服务器收到SYN报文段。服务器收到客户端的SYN报文段，需要对这个SYN报文段进行确认，设置Acknowledgment Number为x+1(Sequence Number+1)；同时，自己自己还要发送SYN请求信息，将SYN位置为1，Sequence Number为y；服务器端将上述所有信息放到一个报文段（即SYN+ACK报文段）中，一并发送给客户端，此时服务器进入SYN_RECV状态；（服务端发包，客户端收到了。客户端得出结论：==服务端的接收、发送能力，客户端的接收、发送能力是正常的==）</li> <li>第三次握手：客户端收到服务器的SYN+ACK报文段。然后将Acknowledgment Number设置为y+1，向服务器发送ACK报文段，这个报文段发送完毕以后，客户端和服务器端都进入ESTABLISHED状态，完成TCP三次握手。（客户端发包，服务端收到了。服务端就能得出结论：==客户端的接收、发送能力，服务端的发送、接收能力是正常的。==）</li> <li>完成了三次握手，客户端和服务器端就可以开始传送数据。以上就是TCP三次握手的总体介绍。</li></ul> <p>总结如下：</p> <ol><li>客户端发送SYN，表明要向服务器建立连接。同时带上序列号ISN</li> <li>服务器返回ACK（序号为客户端序列号+1）作为确认。同时发送SYN作为应答（SYN的序列号为服务端唯一的序号）</li> <li>客户端发送ACK确认收到回复（序列号为服务端序列号+1）</li></ol> <p>为什么需要三次握手，两次可以吗？</p> <ul><li>如果是两次握手，在第二次握手出现确认报文丢失，客户端不知道服务端是否准备好了，这种情况下客户端不会给服务端发数据，也会忽略服务端发过来的数据。</li> <li>如果是三次握手，在第三次握手出现确认报文丢失，服务端在一段时间没有收到客户端的回复报文就会重新第二次握手，客户端收到重复的报文会再次给服务端发送确认报文。</li> <li>==三次握手主要考虑是丢包重连的问题。==</li></ul> <h2 id="四次挥手"><a href="#四次挥手" class="header-anchor">#</a> 四次挥手</h2> <ul><li>第一次分手：主机1，设置Sequence Number和Acknowledgment Number，==向主机2发送一个FIN报文==段；此时，主机1进入FIN_WAIT_1状态；这表示主机1没有数据要发送给主机2了；（ ==主动关闭的一方发送FIN==，表示要单方面关闭数据的传输）</li> <li>第二次分手：==主机2收到了主机1发送的FIN报文段==，==向主机1回一个ACK==报文段，Acknowledgment Number为Sequence Number加1；主机1进入FIN_WAIT_2状态；主机2告诉主机1，我“同意”你的关闭请求；（ ==服务端==收到FIN后，发送一个ACK作为确认）</li> <li>第三次分手：==主机2向主机1发送FIN报文段==，请求关闭连接，同时主机2进入LAST_ACK状态；主机2将最后的数据发送完毕后，给主机1回复确认报文（带有FIN标识），这个才是通知主机1可以释放连接的报文；</li> <li>第四次分手：==主机1收到主机2发送的FIN==报文段，==向主机2发送ACK==报文段，然后主机1进入TIME_WAIT状态；主机2收到主机1的ACK报文段以后，就关闭连接；此时，主机1等待2MSL后依然没有收到回复，则证明Server端已正常关闭，那好，主机1也可以关闭连接了。（==回复ACK以确认回复==）主机1收到主机2回复确认报文后，于是主机1回复确认报文给主机2。而主机2一旦收到主机1发出的确认报文就会立马释放TCP连接，所以主机2结束TCP连接的时间要比主机1早一些。</li></ul> <p>为什么握手需要三次，而挥手需要四次</p> <ul><li>服务端需要确保数据完整性，只能先回复客户端确认报文告诉客户端我收到了报文，进入关闭等待状态。服务端在数据发送完毕后，才回复FIN报文告知客户端数据发送完了，可以断开了，由此多了一次挥手过程。</li></ul> <h2 id="标识说明"><a href="#标识说明" class="header-anchor">#</a> 标识说明</h2> <ul><li>URG：为1时，表示紧急指针有效</li> <li>ACK：确认标识，连接建立成功后，总为1。为1时确认号有效</li> <li>PSH：接收方应尽快把这个报文交给应用层</li> <li>RST：复位标识，重建连接</li> <li>SYN：建立新连接时，该位为0</li> <li>FIN：关闭连接标识</li></ul> <p>参考链接</p> <ul><li><a href="https://juejin.im/post/6844903685563105293" target="_blank" rel="noopener noreferrer">TCP协议详解<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/jawil/blog/issues/14" target="_blank" rel="noopener noreferrer">通俗大白话来理解TCP协议的三次握手和四次分手<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><ul><li><a href="https://juejin.im/post/6869376045636648973?utm_source=gold_browser_extension" target="_blank" rel="noopener noreferrer">金九银十，初中级前端面试复习总结「浏览器、HTTP、前端安全」<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/networkDoc/origin.html" class="prev">
        跨域
      </a></span> <span class="next"><a href="/networkDoc/urlDesc.html">
        输入一个url发生了什么
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.df490d21.js" defer></script><script src="/assets/js/2.9235f093.js" defer></script><script src="/assets/js/23.e2151993.js" defer></script>
  </body>
</html>
